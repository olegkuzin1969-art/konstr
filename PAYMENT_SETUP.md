# Тест оплаты и настройка вебхука ЮKassa

## 1. Тест без реальных денег

В личном кабинете ЮKassa есть **тестовый режим**:

1. Зайди на [yookassa.ru](https://yookassa.ru) → Вход в личный кабинет.
2. В кабинете переключись в **«Тестовый режим»** (переключатель вверху).
3. В разделе **«Настройки» → «Ключи API»** появятся **тестовые** Shop ID и Секретный ключ (они отличаются от боевых).
4. Скопируй тестовые значения и добавь их в Vercel как переменные:
   - `YOOKASSA_SHOP_ID` — тестовый Shop ID  
   - `YOOKASSA_SECRET_KEY` — тестовый Секретный ключ  
5. Сделай Redeploy.

При тестовых ключах ЮKassa не списывает деньги. Для проверки оплаты используй [тестовые карты ЮKassa](https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing#test-bank-card-details), например:
- **Успешная оплата:** `1111 1111 1111 1026`, срок любой в будущем, CVC любой.
- **Отклонение:** `1111 1111 1111 1034`.

Когда закончишь тесты, замени переменные в Vercel на **боевые** Shop ID и Секретный ключ (те, что дал заказчик).

---

## 2. Вебхук (чтобы статусы менялись автоматически)

Чтобы после успешной оплаты у тебя создавался заказ и обновлялись статусы, ЮKassa должна вызывать твой сервер. Для этого нужно один раз настроить вебхук:

1. В личном кабинете ЮKassa открой: [Интеграция → HTTP-уведомления](https://yookassa.ru/my/http-notifications-settings) (или **Настройки** → **Уведомления**).
2. Укажи URL уведомлений:
   ```text
   https://ТВОЙ-ДОМЕН.vercel.app/api/webhook-yookassa
   ```
   Пример: `https://platform-z1.vercel.app/api/webhook-yookassa`
3. Включи событие **«payment.succeeded»** (успешная оплата).
4. Сохрани.

После этого при успешной оплате ЮKassa будет отправлять запрос на этот URL, и твой `api/webhook-yookassa.js` создаст заказ и обновит статус.

**Проверка:** после тестовой оплаты тестовой картой заказ должен появиться в БД/админке без ручных действий.
